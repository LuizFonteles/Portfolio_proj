{# templates/portfolio/home.html #}
{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
{% if user.is_authenticated %}
<div class="container mt-4">

  <h2>Your Followed Stocks</h2>
  {% if stocks %}
    <div class="row">
      {% for sf in stocks %}
        <div class="col-md-4 mb-4">
          <div class="card h-100">
            <div class="card-body d-flex flex-column">
              <h5 class="card-title">{{ sf.ticker.ticker }}</h5>
              <p class="card-text mb-3">
                Followed on: {{ sf.timestamp|date:"Y-m-d H:i" }}
              </p>

              {# Button to toggle alerts #}
              <button
                class="btn btn-sm btn-outline-primary mt-auto"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#alerts-{{ sf.pk }}"
                aria-expanded="false"
                aria-controls="alerts-{{ sf.pk }}"
              >
                View Alerts
              </button>

              {# Collapsible alerts list #}
              <div class="collapse mt-3" id="alerts-{{ sf.pk }}">
                {% if sf.alert_rules.all %}
                  <ul class="list-group">
                    {% for alert in sf.alert_rules.all %}
                      <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                          Threshold: <strong>{{ alert.threshold }}</strong>
                          {% if not alert.active %}
                            <span class="badge bg-secondary">Inactive</span>
                          {% endif %}
                        </div>
                        <a href="{% url 'alert-edit' alert.pk %}" class="btn btn-sm btn-outline-secondary">
                          Edit
                        </a>
                      </li>
                    {% endfor %}
                  </ul>
                {% else %}
                  <p class="text-muted">No alerts for this stock.<br>
                    <a href="{% url 'alert-create' %}">Add one now</a>.
                  </p>
                {% endif %}
              </div>

            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p>Youâ€™re not following any stocks yet. 
       <a href="{% url 'follow-stock' %}">Add one now</a>.
    </p>
  {% endif %}

  <div class="mt-4">
    <a href="{% url 'alert-create' %}" class="btn btn-primary">
      New Alert
    </a>
  </div>

</div>



{% else %}
<div class="col-md-6 offset-md-3"></div>

<h1>Login</h1>
<br/>
<form method="POST" action="{% url 'home' %}">
    {% csrf_token %}
    <form>
        <div class="mb-3">
          <input type="text" class="form-control" name="username", placeholder="username" required >
        </div>
        <br/>
        <div class="mb-3">
          <input type="password" class="form-control" name="password", placeholder="password" required>
        </div>
        <br/>
        <button type="submit" class="btn btn-secondary">Login</button>
      </form>
</form>





{% endif%}

{%endblock%}